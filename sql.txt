drop table subscribes;
drop table user_post;
drop table messages;
drop table conversations;
drop table post;
drop table users;
drop table users_roles;
drop table roles;
create table users(
                             id BIGSERIAL,
                             name varchar(30) not null unique,
                             mail varchar(30) unique,
                             password varchar(256) not null,
                             PRIMARY KEY(id)
);

create table subscribes(
                           source_id bigint not null,
                           target_id bigint not null,
                           PRIMARY KEY(source_id, target_id),
                           FOREIGN KEY(source_id) REFERENCES  users (id) ON DELETE CASCADE,
                           FOREIGN KEY(target_id) REFERENCES  users (id) ON DELETE CASCADE
);

create table post(
                     id BIGSERIAL,
                     header varchar(30),
                     text text,
                     image_url varchar(30),
                     date date,
                     PRIMARY KEY(id)
);
create table user_post(
                          user_id bigint not null,
                          post_id bigint not null,
                          FOREIGN KEY(user_id) REFERENCES  users(id) ON DELETE CASCADE,
                          FOREIGN KEY(post_id) REFERENCES  post (id) ON DELETE CASCADE,
                          PRIMARY KEY(user_id, post_id)
);
create table conversations(
                              id BIGSERIAL,
                              uid1 bigint not null,
                              uid2 bigint not null,
                              primary key (id)
);

create table messages(
                         id BIGSERIAL,
                         conversation_id bigint not null,
                         text text,
                         FOREIGN KEY(conversation_id) REFERENCES  conversations(id) ON DELETE CASCADE,
                         PRIMARY KEY(id)
);


create table roles(
    id serial,
    name varchar(50) not null,
    primary key(id)
);

create table users_roles(
    user_id bigint not null,
    role_id int not null,
    primary key (user_id, role_id),
    foreign key(user_id) references users(id),
    foreign key (role_id) references roles(id)
);

insert into roles(name)
values ('ROLE_USER'), ('ROLE_ADMIN')